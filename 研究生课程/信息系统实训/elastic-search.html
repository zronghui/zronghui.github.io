<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>elastic search - zronghui的博客</title><meta description="[TOC]"><meta property="og:type" content="blog"><meta property="og:title" content="zronghui"><meta property="og:url" content="https://zronghui.github.io/"><meta property="og:site_name" content="zronghui"><meta property="og:description" content="[TOC]"><meta property="og:image" content="https://i.loli.net/2020/03/01/Lxsrj19ucvzetiM.png# https://i.loli.net/2020/02/27/giKJ3UbFhv69o7T.jpg"><meta property="article:published_time" content="2020-03-05T05:58:51.000Z"><meta property="article:modified_time" content="2020-09-08T15:47:13.000Z"><meta property="article:author" content="removeif"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://i.loli.net/2020/03/01/Lxsrj19ucvzetiM.png# https://i.loli.net/2020/02/27/giKJ3UbFhv69o7T.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://zronghui.github.io/"},"headline":"zronghui","image":["https://i.loli.net/2020/03/01/Lxsrj19ucvzetiM.png#https://i.loli.net/2020/02/27/giKJ3UbFhv69o7T.jpg# https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@latest/img/avatar.jpg"],"datePublished":"2020-03-05T05:58:51.000Z","dateModified":"2020-09-08T15:47:13.000Z","author":{"@type":"Person","name":"removeif"},"description":"[TOC]"}</script><link rel="alternative" href="/atom.xml" title="zronghui的博客" type="application/atom+xml"><link rel="icon" href="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@latest/img/wico.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="stylesheet" href="/css/style.css"><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="/js/globalUtils.js"></script></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://www.wntool.com/logo/image.php?output=png?fsize=35&amp;font=Snow.ttf&amp;text=zronghui&amp;mirror=No&amp;color=9933FF&amp;vcolor=3333FF&amp;bgcolor=FFFFFF&amp;alpha=yes&amp;output=png&amp;spacing=5&amp;shadow=no&amp;transparent=yes&amp;icon=no&amp;iconic=&amp;top_spacing=5&amp;left_spacing=6&amp;icon_size=48" alt="zronghui的博客" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/media">影音</a><a class="navbar-item" href="/album">相册</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/zronghui"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-03-05T05:58:51.000Z">2020-03-05</time><a class="commentCountImg" href="/%E7%A0%94%E7%A9%B6%E7%94%9F%E8%AF%BE%E7%A8%8B/%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD/elastic-search.html#comment-container"><span class="display-none-class">e4d76df096c958229e2c17d1b4b7d0d6</span><img class="not-gallery-item" src="/img/chat.svg"> <span class="commentCount" id="e4d76df096c958229e2c17d1b4b7d0d6"> 99+</span>    </a><span class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/%E7%A0%94%E7%A9%B6%E7%94%9F%E8%AF%BE%E7%A8%8B/">研究生课程</a><span> / </span><a class="link-muted" href="/categories/%E7%A0%94%E7%A9%B6%E7%94%9F%E8%AF%BE%E7%A8%8B/%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD/">信息系统实训</a></span><span class="level-item">21 minutes 读完 (大约 3092 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">elastic search</h1><div class="content"><p>[TOC]</p>
<a id="more"></a>

<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>mac</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">brew install elasticsearch</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改 PATH</span></span><br><span class="line">export PATH=/usr/local/Cellar/elasticsearch/6.8.6/bin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装中文分词插件</span></span><br><span class="line">elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.8.6/elasticsearch-analysis-ik-6.8.6.zip</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">elasticsearch</span><br><span class="line">pip3 install 'elasticsearch&gt;=6.0.0,&lt;7.0.0'</span><br></pre></td></tr></table></figure>



<p><a href="https://www.jianshu.com/p/3b0650b5c7bb">用RPM安装Elasticsearch到Linux系统服务 - 简书</a></p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/rpm.html">Install Elasticsearch with RPM | Elasticsearch Reference [6.8] | Elastic</a></p>
<p>先安装 Java8</p>
<p>linux 见博客文章 阿里云/centosUbuntu</p>
<p>打开 <a href="http://localhost:9200/">localhost:9200</a></p>
<img src="https://i.loli.net/2020/03/05/Psf5OvknTA8lo1S.png" alt="Psf5OvknTA8lo1S" style="zoom: 25%;" />



<h2 id="学习"><a href="#学习" class="headerlink" title="学习"></a>学习</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>Relational DB: -&gt;Databases-&gt;Tables-&gt;Rows-&gt;Columns </p>
<p>ElasticSearch: -&gt;Indices-&gt;Types-&gt;Documents-&gt;Fields</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html#_core_datatypes">Field datatypes | Elasticsearch Reference [7.6] | Elastic</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> elasticsearch <span class="keyword">import</span> Elasticsearch</span><br><span class="line">es = Elasticsearch()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 Index</span></span><br><span class="line">result = es.indices.create(index=<span class="string">'news'</span>, ignore=<span class="number">400</span>)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># &#123;'acknowledged': True, 'shards_acknowledged': True, 'index': 'news'&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 Index</span></span><br><span class="line">result = es.indices.delete(index=<span class="string">'news'</span>, ignore=[<span class="number">400</span>, <span class="number">404</span>])</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># &#123;'acknowledged': True&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入数据</span></span><br><span class="line">data = &#123;<span class="string">'title'</span>: <span class="string">'美国留给伊拉克的是个烂摊子吗'</span>, <span class="string">'url'</span>: <span class="string">'http://view.news.qq.com/zt2011/usa_iraq/index.htm'</span>&#125;</span><br><span class="line">result = es.create(index=<span class="string">'news'</span>, doc_type=<span class="string">'politics'</span>, id=<span class="number">1</span>, body=data)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># &#123;'_index': 'news', '_type': 'politics', '_id': '1', '_version': 1, 'result': 'created', '_shards': &#123;'total': 2, 'successful': 1, 'failed': 0&#125;, '_seq_no': 0, '_primary_term': 1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># index 方法也可以插入数据，而且可以不指定 ID，会自动生成， index 也可以更新已经存在的数据</span></span><br><span class="line"><span class="comment"># es.index(index='news', doc_type='politics', body=data)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新数据</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'title'</span>: <span class="string">'美国留给伊拉克的是个烂摊子吗'</span>,</span><br><span class="line">    <span class="string">'url'</span>: <span class="string">'http://view.news.qq.com/zt2011/usa_iraq/index.htm'</span>,</span><br><span class="line">    <span class="string">'date'</span>: <span class="string">'2011-12-16'</span></span><br><span class="line">&#125;</span><br><span class="line">result = es.update(index=<span class="string">'news'</span>, doc_type=<span class="string">'politics'</span>, body=data, id=<span class="number">1</span>)</span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除数据</span></span><br><span class="line">result = es.delete(index=<span class="string">'news'</span>, doc_type=<span class="string">'politics'</span>, id=<span class="number">1</span>)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># &#123;'_index': 'news', '_type': 'politics', '_id': '1', '_version': 3, 'result': 'deleted', '_shards': &#123;'total': 2, 'successful': 1, 'failed': 0&#125;, '_seq_no': 2, '_primary_term': 1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询数据</span></span><br><span class="line">dsl = &#123;</span><br><span class="line">    <span class="string">'query'</span>: &#123;</span><br><span class="line">        <span class="string">'match'</span>: &#123;</span><br><span class="line">            <span class="string">'title'</span>: <span class="string">'中国 领事馆'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">es = Elasticsearch()</span><br><span class="line">result = es.search(index=<span class="string">'news'</span>, doc_type=<span class="string">'politics'</span>, body=dsl)</span><br><span class="line">print(json.dumps(result, indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以上任何执行若报错，返回：</span></span><br><span class="line"><span class="comment"># &#123;'error': &#123;...&#125;, 'status': ...&#125;, 如：</span></span><br><span class="line"><span class="comment"># &#123;'error': &#123;'root_cause': [&#123;'type': 'resource_already_exists_exception', 'reason': 'index [news/QM6yz2W8QE-bflKhc5oThw] already exists', 'index_uuid': 'QM6yz2W8QE-bflKhc5oThw', 'index': 'news'&#125;], 'type': 'resource_already_exists_exception', 'reason': 'index [news/QM6yz2W8QE-bflKhc5oThw] already exists', 'index_uuid': 'QM6yz2W8QE-bflKhc5oThw', 'index': 'news'&#125;, 'status': 400&#125;</span></span><br></pre></td></tr></table></figure>



<p>查询返回结果</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"took"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"successful"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"skipped"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"hits"</span>: &#123;</span><br><span class="line">    <span class="attr">"total"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">"max_score"</span>: <span class="number">2.546152</span>,</span><br><span class="line">    <span class="attr">"hits"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"_index"</span>: <span class="string">"news"</span>,</span><br><span class="line">        <span class="attr">"_type"</span>: <span class="string">"politics"</span>,</span><br><span class="line">        <span class="attr">"_id"</span>: <span class="string">"dk5G9mQBD9BuE5fdHOUm"</span>,</span><br><span class="line">        <span class="attr">"_score"</span>: <span class="number">2.546152</span>,</span><br><span class="line">        <span class="attr">"_source"</span>: &#123;</span><br><span class="line">          <span class="attr">"title"</span>: <span class="string">"中国驻洛杉矶领事馆遭亚裔男子枪击，嫌犯已自首"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"http://news.ifeng.com/world/detail_2011_12/16/11372558_0.shtml"</span>,</span><br><span class="line">          <span class="attr">"date"</span>: <span class="string">"2011-12-18"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"_index"</span>: <span class="string">"news"</span>,</span><br><span class="line">        <span class="attr">"_type"</span>: <span class="string">"politics"</span>,</span><br><span class="line">        <span class="attr">"_id"</span>: <span class="string">"dU5G9mQBD9BuE5fdHOUj"</span>,</span><br><span class="line">        <span class="attr">"_score"</span>: <span class="number">0.2876821</span>,</span><br><span class="line">        <span class="attr">"_source"</span>: &#123;</span><br><span class="line">          <span class="attr">"title"</span>: <span class="string">"中韩渔警冲突调查：韩警平均每天扣1艘中国渔船"</span>,</span><br><span class="line">          <span class="attr">"url"</span>: <span class="string">"https://news.qq.com/a/20111216/001044.htm"</span>,</span><br><span class="line">          <span class="attr">"date"</span>: <span class="string">"2011-12-17"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Hello-world"><a href="#Hello-world" class="headerlink" title="Hello world"></a>Hello world</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pretty_errors</span><br><span class="line"><span class="keyword">from</span> elasticsearch <span class="keyword">import</span> Elasticsearch</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line">mapping = &#123;</span><br><span class="line">    <span class="string">'properties'</span>: &#123;</span><br><span class="line">        <span class="string">'title'</span>: &#123;</span><br><span class="line">            <span class="string">'type'</span>: <span class="string">'text'</span>,</span><br><span class="line">            <span class="string">'analyzer'</span>: <span class="string">'ik_max_word'</span>,</span><br><span class="line">            <span class="string">'search_analyzer'</span>: <span class="string">'ik_max_word'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">es.indices.delete(index=<span class="string">'news'</span>, ignore=[<span class="number">400</span>, <span class="number">404</span>])</span><br><span class="line">es.indices.create(index=<span class="string">'news'</span>, ignore=<span class="number">400</span>)</span><br><span class="line">result = es.indices.put_mapping(index=<span class="string">'news'</span>, doc_type=<span class="string">'politics'</span>, body=mapping)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># &#123;'acknowledged': True&#125;</span></span><br><span class="line"></span><br><span class="line">datas = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'title'</span>: <span class="string">'美国留给伊拉克的是个烂摊子吗'</span>,</span><br><span class="line">        <span class="string">'url'</span>: <span class="string">'http://view.news.qq.com/zt2011/usa_iraq/index.htm'</span>,</span><br><span class="line">        <span class="string">'date'</span>: <span class="string">'2011-12-16'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'title'</span>: <span class="string">'公安部：各地校车将享最高路权'</span>,</span><br><span class="line">        <span class="string">'url'</span>: <span class="string">'http://www.chinanews.com/gn/2011/12-16/3536077.shtml'</span>,</span><br><span class="line">        <span class="string">'date'</span>: <span class="string">'2011-12-16'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'title'</span>: <span class="string">'中韩渔警冲突调查：韩警平均每天扣1艘中国渔船'</span>,</span><br><span class="line">        <span class="string">'url'</span>: <span class="string">'https://news.qq.com/a/20111216/001044.htm'</span>,</span><br><span class="line">        <span class="string">'date'</span>: <span class="string">'2011-12-17'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'title'</span>: <span class="string">'中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首'</span>,</span><br><span class="line">        <span class="string">'url'</span>: <span class="string">'http://news.ifeng.com/world/detail_2011_12/16/11372558_0.shtml'</span>,</span><br><span class="line">        <span class="string">'date'</span>: <span class="string">'2011-12-18'</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> datas:</span><br><span class="line">    debug = es.index(index=<span class="string">'news'</span>, doc_type=<span class="string">'politics'</span>, body=data)</span><br><span class="line">es.indices.refresh(index=<span class="string">"news"</span>)</span><br><span class="line"></span><br><span class="line">result = es.search(index=<span class="string">'news'</span>, doc_type=<span class="string">'politics'</span>)</span><br><span class="line"></span><br><span class="line">print(json.dumps(result, indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line">dsl = &#123;</span><br><span class="line">    <span class="string">'query'</span>: &#123;</span><br><span class="line">        <span class="string">'match'</span>: &#123;</span><br><span class="line">            <span class="string">'title'</span>: <span class="string">'中国'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">es = Elasticsearch()</span><br><span class="line"><span class="comment"># result = es.search(index='news', doc_type='politics', q='中国 领事馆')</span></span><br><span class="line">result = es.search(index=<span class="string">'news'</span>, doc_type=<span class="string">'politics'</span>, body=dsl)</span><br><span class="line"></span><br><span class="line">print(json.dumps(result, indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;'acknowledged': True&#125;</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#   "took": 3,</span></span><br><span class="line"><span class="comment">#   "timed_out": false,</span></span><br><span class="line"><span class="comment">#   "_shards": &#123;</span></span><br><span class="line"><span class="comment">#     "total": 5,</span></span><br><span class="line"><span class="comment">#     "successful": 5,</span></span><br><span class="line"><span class="comment">#     "skipped": 0,</span></span><br><span class="line"><span class="comment">#     "failed": 0</span></span><br><span class="line"><span class="comment">#   &#125;,</span></span><br><span class="line"><span class="comment">#   "hits": &#123;</span></span><br><span class="line"><span class="comment">#     "total": 4,</span></span><br><span class="line"><span class="comment">#     "max_score": 1.0,</span></span><br><span class="line"><span class="comment">#     "hits": [</span></span><br><span class="line"><span class="comment">#       &#123;</span></span><br><span class="line"><span class="comment">#         "_index": "news",</span></span><br><span class="line"><span class="comment">#         "_type": "politics",</span></span><br><span class="line"><span class="comment">#         "_id": "q4xHqnABU_ZbTbliQ7pZ",</span></span><br><span class="line"><span class="comment">#         "_score": 1.0,</span></span><br><span class="line"><span class="comment">#         "_source": &#123;</span></span><br><span class="line"><span class="comment">#           "title": "中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首",</span></span><br><span class="line"><span class="comment">#           "url": "http://news.ifeng.com/world/detail_2011_12/16/11372558_0.shtml",</span></span><br><span class="line"><span class="comment">#           "date": "2011-12-18"</span></span><br><span class="line"><span class="comment">#         &#125;</span></span><br><span class="line"><span class="comment">#       &#125;,</span></span><br><span class="line"><span class="comment">#       &#123;</span></span><br><span class="line"><span class="comment">#         "_index": "news",</span></span><br><span class="line"><span class="comment">#         "_type": "politics",</span></span><br><span class="line"><span class="comment">#         "_id": "qoxHqnABU_ZbTbliQ7pQ",</span></span><br><span class="line"><span class="comment">#         "_score": 1.0,</span></span><br><span class="line"><span class="comment">#         "_source": &#123;</span></span><br><span class="line"><span class="comment">#           "title": "中韩渔警冲突调查：韩警平均每天扣1艘中国渔船",</span></span><br><span class="line"><span class="comment">#           "url": "https://news.qq.com/a/20111216/001044.htm",</span></span><br><span class="line"><span class="comment">#           "date": "2011-12-17"</span></span><br><span class="line"><span class="comment">#         &#125;</span></span><br><span class="line"><span class="comment">#       &#125;,</span></span><br><span class="line"><span class="comment">#       &#123;</span></span><br><span class="line"><span class="comment">#         "_index": "news",</span></span><br><span class="line"><span class="comment">#         "_type": "politics",</span></span><br><span class="line"><span class="comment">#         "_id": "qIxHqnABU_ZbTbliQ7oy",</span></span><br><span class="line"><span class="comment">#         "_score": 1.0,</span></span><br><span class="line"><span class="comment">#         "_source": &#123;</span></span><br><span class="line"><span class="comment">#           "title": "美国留给伊拉克的是个烂摊子吗",</span></span><br><span class="line"><span class="comment">#           "url": "http://view.news.qq.com/zt2011/usa_iraq/index.htm",</span></span><br><span class="line"><span class="comment">#           "date": "2011-12-16"</span></span><br><span class="line"><span class="comment">#         &#125;</span></span><br><span class="line"><span class="comment">#       &#125;,</span></span><br><span class="line"><span class="comment">#       &#123;</span></span><br><span class="line"><span class="comment">#         "_index": "news",</span></span><br><span class="line"><span class="comment">#         "_type": "politics",</span></span><br><span class="line"><span class="comment">#         "_id": "qYxHqnABU_ZbTbliQ7pJ",</span></span><br><span class="line"><span class="comment">#         "_score": 1.0,</span></span><br><span class="line"><span class="comment">#         "_source": &#123;</span></span><br><span class="line"><span class="comment">#           "title": "公安部：各地校车将享最高路权",</span></span><br><span class="line"><span class="comment">#           "url": "http://www.chinanews.com/gn/2011/12-16/3536077.shtml",</span></span><br><span class="line"><span class="comment">#           "date": "2011-12-16"</span></span><br><span class="line"><span class="comment">#         &#125;</span></span><br><span class="line"><span class="comment">#       &#125;</span></span><br><span class="line"><span class="comment">#     ]</span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#   "took": 7,</span></span><br><span class="line"><span class="comment">#   "timed_out": false,</span></span><br><span class="line"><span class="comment">#   "_shards": &#123;</span></span><br><span class="line"><span class="comment">#     "total": 5,</span></span><br><span class="line"><span class="comment">#     "successful": 5,</span></span><br><span class="line"><span class="comment">#     "skipped": 0,</span></span><br><span class="line"><span class="comment">#     "failed": 0</span></span><br><span class="line"><span class="comment">#   &#125;,</span></span><br><span class="line"><span class="comment">#   "hits": &#123;</span></span><br><span class="line"><span class="comment">#     "total": 2,</span></span><br><span class="line"><span class="comment">#     "max_score": 0.2876821,</span></span><br><span class="line"><span class="comment">#     "hits": [</span></span><br><span class="line"><span class="comment">#       &#123;</span></span><br><span class="line"><span class="comment">#         "_index": "news",</span></span><br><span class="line"><span class="comment">#         "_type": "politics",</span></span><br><span class="line"><span class="comment">#         "_id": "q4xHqnABU_ZbTbliQ7pZ",</span></span><br><span class="line"><span class="comment">#         "_score": 0.2876821,</span></span><br><span class="line"><span class="comment">#         "_source": &#123;</span></span><br><span class="line"><span class="comment">#           "title": "中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首",</span></span><br><span class="line"><span class="comment">#           "url": "http://news.ifeng.com/world/detail_2011_12/16/11372558_0.shtml",</span></span><br><span class="line"><span class="comment">#           "date": "2011-12-18"</span></span><br><span class="line"><span class="comment">#         &#125;</span></span><br><span class="line"><span class="comment">#       &#125;,</span></span><br><span class="line"><span class="comment">#       &#123;</span></span><br><span class="line"><span class="comment">#         "_index": "news",</span></span><br><span class="line"><span class="comment">#         "_type": "politics",</span></span><br><span class="line"><span class="comment">#         "_id": "qoxHqnABU_ZbTbliQ7pQ",</span></span><br><span class="line"><span class="comment">#         "_score": 0.2876821,</span></span><br><span class="line"><span class="comment">#         "_source": &#123;</span></span><br><span class="line"><span class="comment">#           "title": "中韩渔警冲突调查：韩警平均每天扣1艘中国渔船",</span></span><br><span class="line"><span class="comment">#           "url": "https://news.qq.com/a/20111216/001044.htm",</span></span><br><span class="line"><span class="comment">#           "date": "2011-12-17"</span></span><br><span class="line"><span class="comment">#         &#125;</span></span><br><span class="line"><span class="comment">#       &#125;</span></span><br><span class="line"><span class="comment">#     ]</span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>



<h2 id="建立索引-插入数据-查询数据"><a href="#建立索引-插入数据-查询数据" class="headerlink" title="建立索引 插入数据 查询数据"></a>建立索引 插入数据 查询数据</h2><p><a href="https://zhuanlan.zhihu.com/p/51242233">ElasticSearch+python完成类似mysql的不分词查询 - 知乎</a></p>
<h3 id="建立索引"><a href="#建立索引" class="headerlink" title="建立索引"></a>建立索引</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">PUT /index_test          // index_test 对应mysql database_name</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"mappings"</span>:&#123;</span><br><span class="line">    <span class="attr">"doc_type"</span>:&#123;        <span class="comment">// doc_type对应 对应mysql table_name</span></span><br><span class="line">      <span class="attr">"properties"</span>: &#123;</span><br><span class="line">          <span class="attr">"field1"</span>: &#123;<span class="attr">"type"</span>: <span class="string">"keyword"</span>&#125;,</span><br><span class="line">          <span class="attr">"field2"</span>: &#123;<span class="attr">"type"</span>: <span class="string">"keyword"</span>&#125;,</span><br><span class="line">          <span class="attr">"field3"</span>: &#123;<span class="attr">"type"</span>: <span class="string">"keyword"</span>&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">例如：</span><br><span class="line"></span><br><span class="line">PUT /fb2m</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"mappings"</span>:&#123;</span><br><span class="line">    <span class="attr">"kb_fact"</span>:&#123;</span><br><span class="line">      <span class="attr">"properties"</span>: &#123;</span><br><span class="line">        <span class="attr">"subject"</span>: &#123;<span class="attr">"type"</span>: <span class="string">"keyword"</span>&#125;,</span><br><span class="line">        <span class="attr">"predicate"</span>: &#123;<span class="attr">"type"</span>: <span class="string">"keyword"</span>&#125;,</span><br><span class="line">        <span class="attr">"object"</span>: &#123;<span class="attr">"type"</span>: <span class="string">"keyword"</span>&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="批量插入数据"><a href="#批量插入数据" class="headerlink" title="批量插入数据"></a>批量插入数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"><span class="keyword">import</span> elasticsearch</span><br><span class="line"><span class="keyword">from</span> elasticsearch <span class="keyword">import</span> helpers</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="comment"># 你的Elasticsearch所对应的IP地址和端口，注意，不是Kibanake可视化界面的地址</span></span><br><span class="line">es = elasticsearch.Elasticsearch([&#123;<span class="string">'host'</span>:<span class="string">'xx.xx.x.xxx'</span>,<span class="string">'port'</span>:xxxx&#125;])</span><br><span class="line"></span><br><span class="line">print(<span class="string">"============== index ================"</span>)</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line">num=<span class="number">0</span></span><br><span class="line">actions = []</span><br><span class="line">max_count = <span class="number">2000</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'dataset/index_data'</span>,<span class="string">'r'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line">        triple = line.strip().split(<span class="string">" ||| "</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            triple_dict = &#123;<span class="string">'field1'</span>:triple[<span class="number">0</span>],<span class="string">'field2'</span>:triple[<span class="number">1</span>],<span class="string">'field3'</span>:triple[<span class="number">2</span>]&#125;</span><br><span class="line">            <span class="comment"># 如果数据量小可以用index的方法一条条插入</span></span><br><span class="line">            <span class="comment"># 这里index，doc_type就等于上一步建立索引所用的名称</span></span><br><span class="line">            <span class="comment">#es.index(index='index_test',doc_type='doc_type',body=triple_dict)</span></span><br><span class="line">            action=&#123;</span><br><span class="line">            <span class="string">"_index"</span>:<span class="string">"index_test"</span>,</span><br><span class="line">            <span class="string">"_type"</span>:<span class="string">"doc_type"</span>,</span><br><span class="line">            <span class="string">"_id"</span>:i,</span><br><span class="line">            <span class="string">"_source"</span>:triple_dict</span><br><span class="line">            &#125;</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            actions.append(action)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            print(<span class="string">" !!! "</span>+ str(j) +<span class="string">" th row insert faied: "</span>+line)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> count&gt;=max_count:</span><br><span class="line">            helpers.bulk(es, actions)</span><br><span class="line">            actions=[]</span><br><span class="line">            count=<span class="number">0</span></span><br><span class="line">            num+=<span class="number">1</span></span><br><span class="line">            print(<span class="string">"Insert "</span>+str(num*max_count)+<span class="string">" records."</span>)</span><br><span class="line">helpers.bulk(es,actions)</span><br><span class="line">print(<span class="string">'finish~~~'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><p><a href="https://www.cnblogs.com/shoufeng/p/11103913.html#3--wildcard-query---%E9%80%9A%E9%85%8D%E7%AC%A6%E6%A3%80%E7%B4%A2">ES 21 - Elasticsearch的高级检索语法 (包括term、prefix、wildcard、fuzzy、boost等) - 瘦风 - 博客园</a></p>
<p>详见博客，↑</p>
<p>1 term query - 索引词检索<br>1.1 term query - 不分词检索<br>1.2 terms query - in检索<br>2 prefix query - 前缀检索<br>3 wildcard query - 通配符检索<br>4 regexp query - 正则检索<br>5 fuzzy query - 纠错检索<br>6 boost评分权重 - 控制文档的优先级别<br>7 dis_max的用法 - best fields策略<br>7.1 dis_max的提出<br>7.2 使用示例<br>8 exist query - 存在检索, 已过期<br>9 复杂检索的使用范例<br>9.1 多条件过滤 - 包含<br>9.2 多条件拼接 - 包含+范围+排序<br>9.3 定制检索结果的排序规则</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">1.不分词查询所有：</span><br><span class="line">select * from doc_type</span><br><span class="line"></span><br><span class="line">GET /index_test/doc_type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"match_all"</span>: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">2.不分词匹配一个字段：</span><br><span class="line">select * from doc_type where filed1=value1</span><br><span class="line"></span><br><span class="line">GET /index_test/doc_type/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"term"</span>: &#123; <span class="attr">"filed1"</span> :<span class="string">"value1 &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">3.不分词同时匹配两个字段：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql：select * from doc_type where filed1=value1 and filed2=value2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ES可以用bool过滤器实现组合检索,一个bool过滤器由三部分组成：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">   "</span>bool<span class="string">" : &#123;</span></span><br><span class="line"><span class="string">      "</span>must<span class="string">" :     [],  //与 AND 等价</span></span><br><span class="line"><span class="string">      "</span>should<span class="string">" :   [],  //与 OR 等价</span></span><br><span class="line"><span class="string">      "</span>must_not<span class="string">" : [],  //与 NOT 等价</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">所有对应代码如下：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GET /index_test/doc_type/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "</span>query<span class="string">": &#123;</span></span><br><span class="line"><span class="string">    "</span>bool<span class="string">": &#123;</span></span><br><span class="line"><span class="string">      "</span>must<span class="string">": [</span></span><br><span class="line"><span class="string">        &#123; "</span>term<span class="string">": &#123; "</span>filed1<span class="string">" :"</span>value1 &#125;&#125;,</span><br><span class="line">        &#123; "term": &#123;  "filed2" :"value2" &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">多字段（Multi-filed）查询</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"multi_match"</span> : &#123;</span><br><span class="line">            <span class="attr">"query"</span> : <span class="string">"elasticsearch guide"</span>,</span><br><span class="line">            <span class="attr">"fields"</span>: [<span class="string">"title"</span>, <span class="string">"summary"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">需要提高某一个字段的分值。在下面的例子中，我们把 summary 字段的分数提高三倍</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"multi_match"</span> : &#123;</span><br><span class="line">            <span class="attr">"query"</span> : <span class="string">"elasticsearch guide"</span>,</span><br><span class="line">            <span class="attr">"fields"</span>: [<span class="string">"title"</span>, <span class="string">"summary^3"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"_source"</span>: [<span class="string">"title"</span>, <span class="string">"summary"</span>, <span class="string">"publish_date"</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">模糊（Fuzzy）查询</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"multi_match"</span> : &#123;</span><br><span class="line">            <span class="attr">"query"</span> : <span class="string">"comprihensiv guide"</span>,</span><br><span class="line">            <span class="attr">"fields"</span>: [<span class="string">"title"</span>, <span class="string">"summary"</span>],</span><br><span class="line">            <span class="attr">"fuzziness"</span>: <span class="string">"AUTO"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"_source"</span>: [<span class="string">"title"</span>, <span class="string">"summary"</span>, <span class="string">"publish_date"</span>],</span><br><span class="line">    <span class="attr">"size"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Python代码检索：</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上面DSL代码query部分复制下来</span></span><br><span class="line">dsl = &#123;</span><br><span class="line"> <span class="string">"query"</span>: &#123;</span><br><span class="line">    <span class="string">"bool"</span>: &#123;</span><br><span class="line">      <span class="string">"must"</span>: [</span><br><span class="line">        &#123; <span class="string">"term"</span>: &#123; <span class="string">"filed1"</span> :<span class="string">"value1"</span>&#125;&#125;,</span><br><span class="line">        &#123; <span class="string">"term"</span>: &#123;  <span class="string">"filed2"</span> :<span class="string">"value2"</span>&#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">es_result = es.search(index=<span class="string">'index_test'</span>, doc_type=<span class="string">'doc_type'</span>, body=dsl)</span><br><span class="line"><span class="comment"># es返回的是一个dict</span></span><br><span class="line">result = es_result[<span class="string">'hits'</span>][<span class="string">'hits'</span>]</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>



<h3 id="更多查询"><a href="#更多查询" class="headerlink" title="更多查询"></a>更多查询</h3><p>详见：<a href="https://n3xtchen.github.io/n3xtchen/elasticsearch/2017/07/05/elasticsearch-23-useful-query-example">19 个很有用的 ElasticSearch 查询语句</a></p>
<ol start="7">
<li>正则（Regexp）查询</li>
<li>短语匹配(Match Phrase)查询</li>
<li>短语前缀（Match Phrase Prefix）查询</li>
<li>查询字符串（Query String）</li>
<li>简单查询字符串（Simple Query String）</li>
<li>词条（Term）/多词条（Terms）查询</li>
<li>词条（Term）查询 - 排序（Sorted）</li>
<li>范围查询</li>
<li>过滤(Filtered)查询</li>
<li>多重过滤（Multiple Filters）</li>
<li>作用分值: 域值（Field Value）因子</li>
<li>作用分值: 衰变（Decay）函数</li>
<li>函数分值: 脚本评分</li>
</ol>
<h3 id="Query-with-highlight"><a href="#Query-with-highlight" class="headerlink" title="Query with highlight"></a>Query with highlight</h3><p><a href="http://doc.codingdict.com/elasticsearch/106/">Highlighting - elasticsearch中文文档</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;query&quot; : &#123; &quot;match&quot; : &#123; &quot;content&quot; : &quot;中国&quot; &#125;&#125;,</span><br><span class="line">    &quot;highlight&quot; : &#123;</span><br><span class="line">        &quot;pre_tags&quot; : [&quot;&lt;tag1&gt;&quot;, &quot;&lt;tag2&gt;&quot;],</span><br><span class="line">        &quot;post_tags&quot; : [&quot;&lt;&#x2F;tag1&gt;&quot;, &quot;&lt;&#x2F;tag2&gt;&quot;],</span><br><span class="line">        &quot;fields&quot; : &#123;</span><br><span class="line">            &quot;content&quot; : &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"took"</span>: <span class="number">14</span>,</span><br><span class="line">    <span class="attr">"timed_out"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"successful"</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"hits"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"max_score"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"hits"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"_index"</span>: <span class="string">"index"</span>,</span><br><span class="line">                <span class="attr">"_type"</span>: <span class="string">"fulltext"</span>,</span><br><span class="line">                <span class="attr">"_id"</span>: <span class="string">"4"</span>,</span><br><span class="line">                <span class="attr">"_score"</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">"_source"</span>: &#123;</span><br><span class="line">                    <span class="attr">"content"</span>: <span class="string">"中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"highlight"</span>: &#123;</span><br><span class="line">                    <span class="attr">"content"</span>: [</span><br><span class="line">                        <span class="string">"&lt;tag1&gt;中国&lt;/tag1&gt;驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首 "</span></span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"_index"</span>: <span class="string">"index"</span>,</span><br><span class="line">                <span class="attr">"_type"</span>: <span class="string">"fulltext"</span>,</span><br><span class="line">                <span class="attr">"_id"</span>: <span class="string">"3"</span>,</span><br><span class="line">                <span class="attr">"_score"</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">"_source"</span>: &#123;</span><br><span class="line">                    <span class="attr">"content"</span>: <span class="string">"中韩渔警冲突调查：韩警平均每天扣1艘中国渔船"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"highlight"</span>: &#123;</span><br><span class="line">                    <span class="attr">"content"</span>: [</span><br><span class="line">                        <span class="string">"均每天扣1艘&lt;tag1&gt;中国&lt;/tag1&gt;渔船 "</span></span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="Elastic-6-x-版只允许每个Index-包含一个Type，7-x-版将会彻底-…"><a href="#Elastic-6-x-版只允许每个Index-包含一个Type，7-x-版将会彻底-…" class="headerlink" title="Elastic 6.x 版只允许每个Index 包含一个Type，7.x 版将会彻底 …"></a>Elastic 6.x 版只允许每个Index 包含一个Type，7.x 版将会彻底 …</h3><p>干！</p>
<h2 id="‘黎明前的黑暗’-分词报错"><a href="#‘黎明前的黑暗’-分词报错" class="headerlink" title="‘黎明前的黑暗’ 分词报错"></a>‘黎明前的黑暗’ 分词报错</h2><p>干！</p>
<p><a href="https://github.com/medcl/elasticsearch-analysis-ik/issues/680">6.7.2，”黎明前的黑暗“ 分词报错 startOffset must be non-negative, and endOffset must be &gt;= startOffset · Issue #680 · medcl/elasticsearch-analysis-ik</a></p>
<h2 id="elasticsearch-dump"><a href="#elasticsearch-dump" class="headerlink" title="elasticsearch-dump"></a>elasticsearch-dump</h2><p><a href="https://github.com/taskrabbit/elasticsearch-dump">taskrabbit/elasticsearch-dump: Import and export tools for elasticsearch</a></p>
<p>use a supported version of node. v8 or higher: 要求 npm 版本 &gt;= 8</p>
<p>导出为 json，或把一个节点的数据复制到另外一个节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">elasticdump \</span><br><span class="line">  --input=http://47.93.53.47:9200/movies \</span><br><span class="line">  --output=http://101.200.240.225:9200/movies \</span><br><span class="line">  --type=mapping</span><br><span class="line">  </span><br><span class="line">elasticdump \</span><br><span class="line">  --input=http://47.93.53.47:9200/books \</span><br><span class="line">  --output=http://101.200.240.225:9200/books \</span><br><span class="line">  --type=mapping</span><br></pre></td></tr></table></figure>



<h2 id="elasticsearch-jieba-plugin"><a href="#elasticsearch-jieba-plugin" class="headerlink" title="elasticsearch-jieba-plugin"></a>elasticsearch-jieba-plugin</h2><p>需要 es 的版本与之对应，更改 es 版本太麻烦了，下次重新安装的时候再注意吧</p>
<p><a href="https://www.twle.cn/l/yufei/elasticsearch/es-basic-segmentation.html">Elasticsearch 中文分词 - 结巴分词 - Elasticsearch 基础教程 - 简单教程，简单编程</a><br><a href="https://github.com/sing1ee/elasticsearch-jieba-plugin">sing1ee/elasticsearch-jieba-plugin: jieba analysis plugin for elasticsearch 7.0.0, 6.4.0, 6.0.0, 5.4.0，5.3.0, 5.2.2, 5.2.1, 5.2, 5.1.2, 5.1.1</a></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="1-网页端搜索引擎请求失败，elasticsearch-Failed-to-establish-a-new-connection"><a href="#1-网页端搜索引擎请求失败，elasticsearch-Failed-to-establish-a-new-connection" class="headerlink" title="1.网页端搜索引擎请求失败，elasticsearch Failed to establish a new connection"></a>1.网页端搜索引擎请求失败，elasticsearch Failed to establish a new connection</h3><p>curl 127.0.0.1:9200</p>
<p>无法连接</p>
<p>systemctl restart elasticsearch.service 后 systemctl status elasticsearch.service -l 可以看到服务启动失败</p>
<p>解决艰辛过程：</p>
<p>systemctl 命令使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.启动、关闭、重启 nfs服务</span><br><span class="line">systemctl start/stop/restart nfs-server.service</span><br><span class="line"></span><br><span class="line">2.设置开机自启动</span><br><span class="line">systemctl enable nfs-server.service</span><br><span class="line"></span><br><span class="line">3.停止开机自启动</span><br><span class="line">systemctl disable nfs-server.service</span><br><span class="line"></span><br><span class="line">4.查看服务当前状态</span><br><span class="line">systemctl status nfs-server.service</span><br><span class="line">systemctl status nfs-server.service -l # 查看全部</span><br><span class="line"></span><br><span class="line">5.查看所有已启动的服务</span><br><span class="line">systemctl list-units --type=service</span><br></pre></td></tr></table></figure>



<p>systemctl status elasticsearch.service -l 可以看到 There is insufficient memory for the Java Runtime Environment to continue Solution</p>
<p>vim /etc/elasticsearch/jvm.options</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -Xms1g</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -Xmx1g</span></span><br><span class="line">-Xms500m</span><br><span class="line">-Xmx500m</span><br></pre></td></tr></table></figure>

<p>设小了可以启动，但是一搜索就又崩了，最后又改成默认的 1g</p>
<p>去 阿里云控制台 查看 mem 使用情况，一直挺高的，但是在服务器内部，使用 ps -aux | sort -k4nr | head 查看内存占用，并没有内存占用特别高的进程</p>
<p>最后，没辙了，<strong>重启服务器</strong>，问题解决，去 阿里云控制台 查看 mem 使用情况，内存占用正常</p>
<h3 id="2-外网访问"><a href="#2-外网访问" class="headerlink" title="2.外网访问"></a>2.外网访问</h3><p>首先, 阿里云安全组里开启 9200 端口</p>
<p><strong>主要解决办法：</strong></p>
<p><a href="https://www.cnblogs.com/xdao/p/elasticsearch_config.html">阿里云安装elastcsearch后外网访问配置 - 半山无极 - 博客园</a></p>
<p>外网访问<br>vim /etc/elasticsearch/elasticsearch.yml </p>
<p>找到 network.host，改为</p>
<p>network.host: 0.0.0.0</p>
<h3 id="3-elasticsearch-3787-could-not-find-java-set-JAVA-HOME"><a href="#3-elasticsearch-3787-could-not-find-java-set-JAVA-HOME" class="headerlink" title="3.elasticsearch[3787]: could not find java; set JAVA_HOME"></a>3.elasticsearch[3787]: could not find java; set JAVA_HOME</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">java -version # 正常</span><br><span class="line">echo $JAVA_HOME # 正常</span><br><span class="line">vim /etc/sysconfig/elasticsearch</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置JAVA_HOME环境变量</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 再次尝试启动</span></span><br><span class="line">sudo systemctl start elasticsearch.service</span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查状态</span></span><br><span class="line">systemctl status elasticsearch.service -l</span><br><span class="line">curl -XGET 'localhost:9200'</span><br></pre></td></tr></table></figure>



<p>4.elasticsearch.service: Failed at step USER spawning /usr/share/elas….</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/elasticsearch.service</span><br><span class="line"><span class="meta">#</span><span class="bash"> 然后注释掉 user 和 group</span></span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart elasticsearch.service</span><br><span class="line">systemctl status elasticsearch.service -l</span><br></pre></td></tr></table></figure>





<h2 id="相关社区、教程"><a href="#相关社区、教程" class="headerlink" title="相关社区、教程"></a>相关社区、教程</h2><p><a href="https://elasticsearch-py.readthedocs.io/en/master/index.html">Python Elasticsearch Client — Elasticsearch 7.5.1 documentation</a></p>
<p><a href="https://es.xiaoleilu.com/index.html">Introduction | Elasticsearch权威指南（中文版）</a><br><a href="http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html">全文搜索引擎 Elasticsearch 入门教程 - 阮一峰的网络日志</a><br><a href="https://elasticsearch.cn/">Elastic 中文社区</a></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://cuiqingcai.com/6214.html">Elasticsearch 基本介绍及其与 Python 的对接实现 | 静觅</a></p>
<p><a href="https://n3xtchen.github.io/n3xtchen/elasticsearch/2017/07/05/elasticsearch-23-useful-query-example">19 个很有用的 ElasticSearch 查询语句</a></p>
<p><a href="https://github.com/medcl/elasticsearch-analysis-ik/blob/master/README.md">elasticsearch-analysis-ik/README.md at master · medcl/elasticsearch-analysis-ik</a></p>
<p><a href="https://www.tutorialspoint.com/elasticsearch/elasticsearch_mapping.htm">Elasticsearch - Mapping - Tutorialspoint</a></p>
<p><a href="https://juejin.im/post/5d346f9551882549a70ad729">Python Elasticsearch DSL 查询、过滤、聚合操作实例 - 掘金</a><br><a href="https://www.jianshu.com/p/462007422e65">Python3 操作 elasticsearch - 简书</a></p>
<p><a href="https://juejin.im/post/5d5a9583e51d456206115a06">干货 | Elasticsearch、Kibana数据导出实战 - 掘金</a></p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html#_core_datatypes">Field datatypes | Elasticsearch Reference [7.6] | Elastic</a></p>
<p><a href="https://www.jianshu.com/p/c6f3368c13a3">elasticsearch.yml 配置详解（转） - 简书</a><br><a href="https://www.benderfly.com/index.php?article-3.html">配置Elasticsearch - Elastic 中文问答社区</a></p>
</div><ul class="post-copyright"><li><strong>本文标题：</strong><a href="https://zronghui.github.io/%E7%A0%94%E7%A9%B6%E7%94%9F%E8%AF%BE%E7%A8%8B/%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD/elastic-search.html">elastic search</a></li><li><strong>本文作者：</strong><a href="https://zronghui.github.io">zronghui</a></li><li><strong>本文链接：</strong><a href="https://zronghui.github.io/%E7%A0%94%E7%A9%B6%E7%94%9F%E8%AF%BE%E7%A8%8B/%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD/elastic-search.html">https://zronghui.github.io/研究生课程/信息系统实训/elastic-search.html</a></li><li><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li></ul><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7"># 推荐文章</span><br><span>  1.<a class="is-size-6" href="/Leetcode%20weekly%20contest/biweekly-contest-22.html" target="_blank">biweekly-contest-22</a><br></span><span>  2.<a class="is-size-6" href="/leetcode/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E9%87%91%E5%85%B8/%E9%9D%A2%E8%AF%95%E9%A2%98-01-07-%E6%97%8B%E8%BD%AC%E7%9F%A9%E9%98%B5.html" target="_blank">面试题 01.07 旋转矩阵</a><br></span><span>  3.<a class="is-size-6" href="/Chrome/chrome-%E6%8F%92%E4%BB%B6.html" target="_blank">chrome 插件</a><br></span><span>  4.<a class="is-size-6" href="/Leetcode%20weekly%20contest/biweekly-contest-23.html" target="_blank">biweekly-contest-23</a><br></span><span>  5.<a class="is-size-6" href="/Leetcode%20weekly%20contest/weekly-contest-180.html" target="_blank">weekly-contest-180</a><br></span></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><div class="social-share"></div><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button is-info donate"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="https://i.loli.net/2020/03/05/MeFCknt1wipKvRA.png" alt="支付宝"></span></a><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="https://i.loli.net/2020/03/05/MVJrxG3gO6qHSiz.png" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/%E7%A0%94%E7%A9%B6%E7%94%9F%E8%AF%BE%E7%A8%8B/%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD/django.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">django</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/Mac/06-tmux.html"><span class="level-item">tmux</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.6.2/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: 'e4d76df096c958229e2c17d1b4b7d0d6',
            repo: 'blog_comment',
            owner: 'zronghui',
            clientID: 'f1c7f9da01111d2e7163',
            clientSecret: '3aaaf709bd8edda1f4c57484cceba5fad5218978',
            admin: ["zronghui"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: 'last',
            
            
            enableHotKey: true,
            isLocked: false
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget toc-scroll" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" id="toc-item-安装" href="#安装"><span>安装</span></a></li><li><a class="is-flex" id="toc-item-学习" href="#学习"><span>学习</span></a><ul class="menu-list"><li><a class="is-flex" id="toc-item-基本概念" href="#基本概念"><span>基本概念</span></a></li></ul></li><li><a class="is-flex" id="toc-item-使用" href="#使用"><span>使用</span></a></li><li><a class="is-flex" id="toc-item-Hello-world" href="#Hello-world"><span>Hello world</span></a></li><li><a class="is-flex" id="toc-item-建立索引-插入数据-查询数据" href="#建立索引-插入数据-查询数据"><span>建立索引 插入数据 查询数据</span></a><ul class="menu-list"><li><a class="is-flex" id="toc-item-建立索引" href="#建立索引"><span>建立索引</span></a></li><li><a class="is-flex" id="toc-item-批量插入数据" href="#批量插入数据"><span>批量插入数据</span></a></li><li><a class="is-flex" id="toc-item-查询数据" href="#查询数据"><span>查询数据</span></a></li><li><a class="is-flex" id="toc-item-更多查询" href="#更多查询"><span>更多查询</span></a></li><li><a class="is-flex" id="toc-item-Query-with-highlight" href="#Query-with-highlight"><span>Query with highlight</span></a></li><li><a class="is-flex" id="toc-item-Elastic-6-x-版只允许每个Index-包含一个Type，7-x-版将会彻底-…" href="#Elastic-6-x-版只允许每个Index-包含一个Type，7-x-版将会彻底-…"><span>Elastic 6.x 版只允许每个Index 包含一个Type，7.x 版将会彻底 …</span></a></li></ul></li><li><a class="is-flex" id="toc-item-‘黎明前的黑暗’-分词报错" href="#‘黎明前的黑暗’-分词报错"><span>‘黎明前的黑暗’ 分词报错</span></a></li><li><a class="is-flex" id="toc-item-elasticsearch-dump" href="#elasticsearch-dump"><span>elasticsearch-dump</span></a></li><li><a class="is-flex" id="toc-item-elasticsearch-jieba-plugin" href="#elasticsearch-jieba-plugin"><span>elasticsearch-jieba-plugin</span></a></li><li><a class="is-flex" id="toc-item-问题" href="#问题"><span>问题</span></a><ul class="menu-list"><li><a class="is-flex" id="toc-item-1-网页端搜索引擎请求失败，elasticsearch-Failed-to-establish-a-new-connection" href="#1-网页端搜索引擎请求失败，elasticsearch-Failed-to-establish-a-new-connection"><span>1.网页端搜索引擎请求失败，elasticsearch Failed to establish a new connection</span></a></li><li><a class="is-flex" id="toc-item-2-外网访问" href="#2-外网访问"><span>2.外网访问</span></a></li><li><a class="is-flex" id="toc-item-3-elasticsearch-3787-could-not-find-java-set-JAVA-HOME" href="#3-elasticsearch-3787-could-not-find-java-set-JAVA-HOME"><span>3.elasticsearch[3787]: could not find java; set JAVA_HOME</span></a></li></ul></li><li><a class="is-flex" id="toc-item-相关社区、教程" href="#相关社区、教程"><span>相关社区、教程</span></a></li><li><a class="is-flex" id="toc-item-参考链接" href="#参考链接"><span>参考链接</span></a></li></ul></div></div><script type="text/javascript" async>
        $(document).ready(function () { //参考自 https://github.com/ppoffice/hexo-theme-icarus/pull/616/files
            var observerTopMargin;
            var scrollObserver;
            var headerElems = $(".headerlink");
            var activeTocItem;
        
            function initIntersectionObserver(docHeight) {
                observerTopMargin = docHeight;
                scrollObserver = new IntersectionObserver(scrollCallBack,
                    {
                        root: null,  // viewpoint
                        rootMargin: docHeight + "px 0px -80% 0px"  // cover top 30% of viewport to the top of document
                    })
            }
        
            function scrollCallBack(entries, observer) {
                if ($(window).scrollTop() > observerTopMargin * 0.7) { 
                    // User somehow scroll to 70% of observerTopMargin (which is inited as 200% document height)
                    // Observer top margin need to extend to cover all the space to the top of the document
                    initIntersectionObserver(observerTopMargin * 2)
                    observer.disconnect();
                    return;
                }
                let toActive;
                if (entries[0].intersectionRatio == 1) {  // enter viewed area
                    let entry = entries.reduce((u, v) => (u.target.toc_id > v.target.toc_id ? u : v));  // get the lowest item
                    toActive = $("#toc-item-" + $(entry.target).attr("href").substr(1));
                } else {
                    let entry = entries.reduce((u, v) => (u.target.toc_id < v.target.toc_id ? u : v));  // get the highest item
                    let idx = Math.max(entry.target.toc_id - 1, 0);
                    toActive = $("#toc-item-" + $(headerElems[idx]).attr("href").substr(1));
                }
                if (activeTocItem) activeTocItem.removeClass("is-current");
                activeTocItem = toActive
                activeTocItem.addClass("is-current");
            }
        
            initIntersectionObserver($(document).height() * 2);
            headerElems.each(function (index, obj) {
                obj.toc_id = index;
                scrollObserver.observe(obj);
            })
        });</script></div><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="https://i.loli.net/2020/02/27/giKJ3UbFhv69o7T.jpg" alt="zronghui"></figure><p class="title is-size-4 is-block line-height-inherit">zronghui</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">582</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">49</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">48</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/zronghui" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/zronghui"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"来源《"+data.from+"》</p><p>提供者-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-12-01T14:15:50.000Z">2020-12-01</time></p><p class="title is-6"><a class="link-muted" href="/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E3%80%8AMySQL8-cookbook%E3%80%8B-%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0.html">《MySQL8 cookbook》 阅读笔记</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-11-29T14:16:28.000Z">2020-11-29</time></p><p class="title is-6"><a class="link-muted" href="/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E3%80%8ARedis-%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E3%80%8B.html">《Redis 设计与实现》</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-11-29T14:16:13.000Z">2020-11-29</time></p><p class="title is-6"><a class="link-muted" href="/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E3%80%8AMongoDB-%E5%AE%9E%E6%88%98%E3%80%8B%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0.html">《MongoDB 实战》阅读笔记</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-11-29T14:15:56.000Z">2020-11-29</time></p><p class="title is-6"><a class="link-muted" href="/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E3%80%8ALinux-Shell-%E8%84%9A%E6%9C%AC%E6%94%BB%E7%95%A5%E3%80%8B%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0.html">《Linux Shell 脚本攻略》阅读笔记</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-11-29T07:52:12.000Z">2020-11-29</time></p><p class="title is-6"><a class="link-muted" href="/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4-MYSQL45%E8%AE%B2-%E7%AC%94%E8%AE%B0.html">极客时间-MYSQL45讲-笔记</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey"> </i><a class="link-muted" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Chrome/"><span class="level-start"><span class="level-item">Chrome</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Leetcode-weekly-contest/"><span class="level-start"><span class="level-item">Leetcode weekly contest</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Mac/"><span class="level-start"><span class="level-item">Mac</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/blockchain/"><span class="level-start"><span class="level-item">blockchain</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/docker-k8s/"><span class="level-start"><span class="level-item">docker k8s</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/frontEnd/"><span class="level-start"><span class="level-item">frontEnd</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/go/"><span class="level-start"><span class="level-item">go</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/java/"><span class="level-start"><span class="level-item">java</span></span><span class="level-end"><span class="level-item tag">40</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/java/Collections/"><span class="level-start"><span class="level-item">Collections</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li></ul></li><a class="level is-mobile is-marginless" href="/categories/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Array/"><span class="tag">Array</span><span class="tag is-grey-lightest">35</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tree/"><span class="tag">Tree</span><span class="tag is-grey-lightest">34</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dynamic-Programming/"><span class="tag">Dynamic Programming</span><span class="tag is-grey-lightest">21</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Binary-Search/"><span class="tag">Binary Search</span><span class="tag is-grey-lightest">20</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hash-Table/"><span class="tag">Hash Table</span><span class="tag is-grey-lightest">19</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Depth-first-Search/"><span class="tag">Depth-first Search</span><span class="tag is-grey-lightest">19</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag is-grey-lightest">16</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Math/"><span class="tag">Math</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Two-Pointers/"><span class="tag">Two Pointers</span><span class="tag is-grey-lightest">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/String/"><span class="tag">String</span><span class="tag is-grey-lightest">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linked-List/"><span class="tag">Linked List</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Stack/"><span class="tag">Stack</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Backtracking/"><span class="tag">Backtracking</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Heap/"><span class="tag">Heap</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Breadth-first-Search/"><span class="tag">Breadth-first Search</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tricks/"><span class="tag">tricks</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Design/"><span class="tag">Design</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bit-Manipulation/"><span class="tag">Bit Manipulation</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Sort/"><span class="tag">Sort</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Divide-and-Conquer/"><span class="tag">Divide and Conquer</span><span class="tag is-grey-lightest">5</span></a></div></div><div class="field is-grouped is-grouped-multiline"><a class="tags has-addons" href="/tags/"><span class="tag">查看全部&gt;&gt;</span></a></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=zronghui&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="zronghui" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="订阅"></div></div><p class="help">输入邮箱开始订阅，更博后邮件通知！</p></form></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://www.wntool.com/logo/image.php?output=png?fsize=35&amp;font=Snow.ttf&amp;text=zronghui&amp;mirror=No&amp;color=9933FF&amp;vcolor=3333FF&amp;bgcolor=FFFFFF&amp;alpha=yes&amp;output=png&amp;spacing=5&amp;shadow=no&amp;transparent=yes&amp;icon=no&amp;iconic=&amp;top_spacing=5&amp;left_spacing=6&amp;icon_size=48" alt="zronghui的博客" height="28"></a><p class="size-small"><span>&copy; 2020 zronghui</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>,Modify by <a href="https://github.com/removeif" target="_blank">removeif</a> <br>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br>    方便于网友与自己学习交流，如有侵权，请<a href="https://zronghui.github.io/message/" target="_blank">留言</a>，立即处理]<br><script type="text/javascript" src="/js/statistics.js"></script><span id="statistic-times"></span><br></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/zronghui"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-Hans");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://zronghui.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back-to-top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script src="/js/gallery.js" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/comment-issue-data.js" defer></script><link rel="stylesheet" href="/css/insight.css"><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="想要查找什么..."><span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>(function (window) {
            var INSIGHT_CONFIG = {
                TRANSLATION: {
                    POSTS: '文章',
                    PAGES: '页面',
                    CATEGORIES: '分类',
                    TAGS: '标签',
                    UNTITLED: '(无标题)',
                },
                CONTENT_URL: '/content.json',
            };
            window.INSIGHT_CONFIG = INSIGHT_CONFIG;
        })(window);</script><script src="/js/insight.js" defer></script></body></html>